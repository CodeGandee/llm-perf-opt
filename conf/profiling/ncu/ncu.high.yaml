# Nsight Compute preset (High Coverage)
# Includes everything from ncu.default plus the union of sections used by
# the RTX 3090 presets (balanced/compute/memory). Use when you want broader
# section coverage in a single run.

description: Highâ€‘coverage Nsight Compute preset (default metrics + union of GA102 sections)

ncu_cli:
  # Profile all child processes by default (matches `--target-processes all`).
  target_processes: all

  # Optional NVTX gating
  # By default, do not limit profiling to a particular NVTX tag.
  # Uncomment to gate on NVTX ranges (example):
  # nvtx:
  #   include: decode*   # Only profile kernels inside NVTX ranges whose name matches 'decode*'

  # Section preset
  set: roofline           # Built-in NCU preset for roofline/SpeedOfLight analyses

  # Metrics to collect (concise, device-portable set)
  metrics:
    - flop_count_hp       # Half-precision floating-point operation count
    - flop_count_sp       # Single-precision floating-point operation count
    - gpu__time_duration.sum  # Total kernel duration on GPU timeline
    - sm__throughput.avg.pct_of_peak_sustained_elapsed   # SM throughput (% of peak sustained)
    - dram__throughput.avg.pct_of_peak_sustained_elapsed # DRAM throughput (% of peak sustained)

  # Sections to include in the report (union of RTX 3090 presets)
  sections:
    - SpeedOfLight            # High-level utilization vs peak for compute/memory
    - ComputeWorkloadAnalysis # Compute pipeline utilization (Tensor, FP, INT)
    - MemoryWorkloadAnalysis  # Memory hierarchy behavior and bandwidth analysis
    - WorkloadDistribution    # Workload distribution by memory/cache levels
    - Occupancy               # Achieved vs theoretical occupancy and limiting factors
    - SchedulerStats          # Warp issue eligibility/scheduling statistics
    - WarpStateStats          # Stall reasons by warp state
    - LaunchStats             # Grid/block dimensions and resource usage
    - InstructionStats        # Instruction mix and counts

  # Advanced NCU CLI controls (script-managed per-kernel; shown for reference)
  # kernel_name_base: demangled   # => --kernel-name-base demangled
  # kernel_name: regex:...        # => --kernel-name regex:<pattern> (per kernel)
  # launch_skip: 200              # => --launch-skip <N> (script default 200)
  # launch_count: 1               # => --launch-count <M> (script default 1)

  # Export preferences for downstream tooling (CSV-friendly outputs)
  export:
    csv: true

  # Enable safe overwrite of existing outputs (maps to --force-overwrite)
  force_overwrite: true
