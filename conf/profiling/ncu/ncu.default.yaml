# Nsight Compute defaults (Stage 2)
# Preset intended for general roofline collection with additional FLOP counts.

description: Default Nsight Compute preset aligned with script defaults

# New structured schema: all Nsight Compute arguments live under `ncu_cli`.
ncu_cli:
  # Profile all child processes by default (matches `--target-processes all`).
  target_processes: all

  # Optional NVTX gating
  # By default, do not limit profiling to a particular NVTX tag.
  # Uncomment to gate on NVTX ranges (example):
  # nvtx:
  #   include: decode*   # Only profile kernels inside NVTX ranges whose name matches 'decode*'

  # Section preset
  set: roofline           # Built-in NCU preset for roofline/SpeedOfLight analyses

  # Kernel name matching base for regex (maps to --kernel-name-base)
  kernel_name_base: demangled

  # Metrics to collect (concise, device-portable set)
  metrics:
    - flop_count_hp       # Half-precision floating-point operation count
    - flop_count_sp       # Single-precision floating-point operation count
    - gpu__time_duration.sum  # Total kernel duration on GPU timeline
    - sm__throughput.avg.pct_of_peak_sustained_elapsed   # SM throughput (% of peak sustained)
    - dram__throughput.avg.pct_of_peak_sustained_elapsed # DRAM throughput (% of peak sustained)

  # Sections to include in the report (high-signal summaries)
  sections:
    - SpeedOfLight           # High-level utilization vs peak for compute/memory
    - MemoryWorkloadAnalysis # Memory hierarchy behavior and bandwidth analysis
    - Occupancy              # Achieved vs theoretical occupancy and limiting factors
    - SchedulerStats         # Warp issue eligibility/scheduling statistics

  # Advanced NCU CLI controls (script-managed per-kernel; shown for reference)
  # Kernel name filtering (maps to --kernel-name or -k):
  #   - Exact match (default): kernel_name: my_exact_kernel_name
  #   - Regex match: kernel_name: regex:my_pattern
  #   Since NCU 2021.1+, exact match is default; use "regex:" prefix for pattern matching.
  # kernel_name: my_kernel        # => --kernel-name my_kernel (exact match)
  # kernel_name: regex:my_.*      # => --kernel-name regex:my_.* (regex match)
  # launch_skip: 200              # => --launch-skip <N> (script default 200)
  # launch_count: 1               # => --launch-count <M> (script default 1)

  # Export preferences for downstream tooling (CSV-friendly outputs)
  export:
    csv: true

  # Enable safe overwrite of existing outputs (maps to --force-overwrite)
  force_overwrite: true
